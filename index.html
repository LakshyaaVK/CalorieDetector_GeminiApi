<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Calorie Detector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .card {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease-in-out;
        }
        .upload-area {
            border: 3px dashed #d1d5db;
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover, .upload-area.dragover {
            border-color: #4f46e5;
            background-color: #f0f2ff;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <main class="w-full max-w-2xl mx-auto">
        <div class="card p-8 md:p-12">
           
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800">AI Calorie Detector</h1>
                <p class="text-gray-500 mt-2">Upload a photo of your meal to get an estimated calorie count.</p>
            </div>

            
            <div id="uploadContainer">
                <div id="uploadArea" class="upload-area">
                    <input type="file" id="imageUpload" class="hidden" accept="image/*">
                    <div class="flex flex-col items-center">
                        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <p class="mt-2 text-sm text-gray-600">
                            <span class="font-semibold text-indigo-600">Click to upload</span> or drag and drop
                        </p>
                        <p class="text-xs text-gray-500">PNG, JPG, WEBP up to 10MB</p>
                    </div>
                </div>
            </div>

         
            <div id="analysisContainer" class="hidden">
                <div class="relative mb-6">
                    <img id="imagePreview" src="#" alt="Food preview" class="w-full h-auto max-h-80 object-contain rounded-lg shadow-md">
                </div>

             
                <div id="loader" class="flex flex-col items-center justify-center text-center">
                    <div class="loader"></div>
                    <p class="text-gray-600 mt-4">Analyzing your meal... this may take a moment.</p>
                </div>

             
                <div id="results" class="hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Nutritional Estimate</h2>
                    <div id="resultsContent"></div>
                     <div class="mt-6 text-center">
                        <button id="resetButton" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition">Analyze Another Meal</button>
                    </div>
                </div>
            </div>

          
            <div id="disclaimer" class="mt-8 text-xs text-gray-400 text-center">
                <p><span class="font-bold">Disclaimer:</span> This is an AI-powered estimate. Actual calorie counts may vary based on portion sizes, ingredients, and preparation methods. This tool is for informational purposes only and is not a substitute for professional medical or nutritional advice.</p>
            </div>
             
            <div id="errorMessage" class="hidden mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative" role="alert">
                <strong class="font-bold">Oops!</strong>
                <span class="block sm:inline" id="errorText">Something went wrong. Please try again.</span>
            </div>
        </div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const uploadArea = document.getElementById('uploadArea');
            const imageUpload = document.getElementById('imageUpload');
            const uploadContainer = document.getElementById('uploadContainer');
            const analysisContainer = document.getElementById('analysisContainer');
            const imagePreview = document.getElementById('imagePreview');
            const loader = document.getElementById('loader');
            const results = document.getElementById('results');
            const resultsContent = document.getElementById('resultsContent');
            const resetButton = document.getElementById('resetButton');
            const disclaimer = document.getElementById('disclaimer');
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');

            uploadArea.addEventListener('click', () => imageUpload.click());
            imageUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    handleImage(file);
                }
            });

          
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false);
            });

            uploadArea.addEventListener('drop', (event) => {
                const dt = event.dataTransfer;
                const file = dt.files[0];
                if (file) {
                    handleImage(file);
                }
            }, false);

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            resetButton.addEventListener('click', () => {
               
                imageUpload.value = ''; 
                uploadContainer.classList.remove('hidden');
                analysisContainer.classList.add('hidden');
                results.classList.add('hidden');
                loader.classList.remove('hidden');
                resultsContent.innerHTML = '';
                disclaimer.classList.remove('hidden');
                errorMessage.classList.add('hidden');
            });

            async function handleImage(file) {
                if (!file.type.startsWith('image/')) {
                    showError("Please upload an image file.");
                    return;
                }

               
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    uploadContainer.classList.add('hidden');
                    analysisContainer.classList.remove('hidden');
                    getCalorieEstimate(file);
                };
                reader.readAsDataURL(file);
            }

            function toBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result.split(',')[1]);
                    reader.onerror = error => reject(error);
                });
            }

            async function getCalorieEstimate(file) {
                loader.classList.remove('hidden');
                results.classList.add('hidden');
                errorMessage.classList.add('hidden');
                disclaimer.classList.add('hidden');

                try {
                    const base64ImageData = await toBase64(file);

                    const systemPrompt = `You are a nutrition analysis expert. Your task is to analyze an image of a meal and provide a detailed breakdown of the food items and their estimated calorie content.

                    Follow these instructions carefully:
                    1.  Identify each distinct food item in the image.
                    2.  For each item, estimate its weight in grams. Be realistic with portion sizes.
                    3.  For each item, estimate its calorie count based on the estimated weight.
                    4.  Calculate the total estimated calories for the entire meal.
                    5.  Provide the output ONLY in a valid JSON format. Do not include any text, markdown formatting, or explanations before or after the JSON object.

                    The JSON object should have the following structure:
                    {
                      "totalCalories": <number>,
                      "items": [
                        {
                          "foodItem": "<string>",
                          "weightGrams": <number>,
                          "calories": <number>
                        },
                        ...
                      ]
                    }
                    `;

                    const userQuery = "Analyze the provided meal image and return the nutritional information in the specified JSON format.";
                    
                    // PASTE YOUR GOOGLE AI API KEY HERE
                    // You can get a free key from Google AI Studio (https://aistudio.google.com/app/apikey)
                    const apiKey = ""; // <-- PASTE YOUR KEY BETWEEN THE QUOTATION MARKS
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    const payload = {
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        },
                        contents: [{
                            parts: [
                                { text: userQuery },
                                {
                                    inlineData: {
                                        mimeType: file.type,
                                        data: base64ImageData
                                    }
                                }
                            ]
                        }],
                        generationConfig: {
                           responseMimeType: "application/json",
                        }
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.text();
                        throw new Error(`API request failed with status ${response.status}: ${errorBody}`);
                    }

                    const result = await response.json();

                    const candidate = result.candidates?.[0];
                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const jsonText = candidate.content.parts[0].text;
                        const data = JSON.parse(jsonText);
                        displayResults(data);
                    } else {
                        throw new Error("Invalid response structure from API.");
                    }

                } catch (error) {
                    console.error("Error analyzing image:", error);
                    showError("Failed to analyze the image. The AI may not have recognized the food, or there was a network issue. Please try a different image.");
                } finally {
                    loader.classList.add('hidden');
                    disclaimer.classList.remove('hidden');
                }
            }

            function displayResults(data) {
                if (!data || !data.items || !data.totalCalories) {
                     showError("Could not parse the analysis data. Please try again.");
                     return;
                }
                resultsContent.innerHTML = ''; 

                
                const totalCaloriesDiv = document.createElement('div');
                totalCaloriesDiv.className = 'text-center bg-indigo-50 p-6 rounded-xl mb-6';
                totalCaloriesDiv.innerHTML = `
                    <p class="text-lg text-indigo-800 font-medium">Total Estimated Calories</p>
                    <p class="text-5xl font-bold text-indigo-600">${Math.round(data.totalCalories)}</p>
                `;
                resultsContent.appendChild(totalCaloriesDiv);

                
                const table = document.createElement('table');
                table.className = 'w-full text-left table-auto';
                table.innerHTML = `
                    <thead>
                        <tr class="border-b-2 border-gray-200">
                            <th class="py-2 px-4 text-sm font-semibold text-gray-600">Food Item</th>
                            <th class="py-2 px-4 text-sm font-semibold text-gray-600 text-right">Weight (g)</th>
                            <th class="py-2 px-4 text-sm font-semibold text-gray-600 text-right">Calories (kcal)</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                `;
                const tbody = table.querySelector('tbody');
                data.items.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-100';
                    row.innerHTML = `
                        <td class="py-3 px-4 font-medium text-gray-800 capitalize">${item.foodItem}</td>
                        <td class="py-3 px-4 text-gray-600 text-right">${Math.round(item.weightGrams)}g</td>
                        <td class="py-3 px-4 text-gray-600 text-right">${Math.round(item.calories)}</td>
                    `;
                    tbody.appendChild(row);
                });
                resultsContent.appendChild(table);

                results.classList.remove('hidden');
            }

            function showError(message) {
                errorText.textContent = message;
                errorMessage.classList.remove('hidden');
                loader.classList.add('hidden');
                analysisContainer.classList.remove('hidden'); 
                results.classList.add('hidden');
            }
        });
    </script>
</body>
</html>

